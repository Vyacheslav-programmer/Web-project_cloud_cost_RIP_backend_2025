# Лабораторная работа 2: База данных и ORM

**Тема:** Оценка стоимости облачного хостинга для веб-проекта  
**Студент:** Пронин Вячеслав Константинович, ИУ5Ц-73Б  
**Ветка:** `database-orm`

#### Цель работы
Разработка структуры базы данных и ее подключение к бэкенду системы оценки стоимости облачного хостинга.

#### Задание
Создание базы данных `PostgreSQL` по теме работы, подключение БД к созданным трем шаблонам.

Необходимо разработать структуру БД по теме облачного хостинга и ее реализовать с учетом требований ниже. Использовать таблицу `тарифов облачного хостинга` в страницах разработанного приложения. Наполнить таблицы БД данными через `админку Django` или `Adminer`.

Получение и поиск `тарифов`, добавление `тарифа` в текущий `расчёт стоимости` (статус черновик она же "корзина"), а также просмотр этого `расчёта` сделать через `ORM`. Для страницы текущего `расчёта` добавить кнопку логического удаления `расчёта` (статус меняется на удален) с помощью выполнения SQL запроса `UPDATE`, без ORM. Всего пять HTTP методов: три GET и один POST добавления в расчёт через `ORM`, еще один POST для удаления расчёта через SQL.

При отсутствии `расчёта` в статусе черновик у пользователя, он создается только при добавлении `тарифа` в `расчёт`. Если такой `расчёт` уже есть, то `тариф` добавляется сразу в него. Удаленные расчёты просматривать нельзя, если у пользователя нет текущего `расчёта`, его карточка на странице тарифов не активна.

**Требования к БД**

Обязательно наличие 4 таблиц (каскадное удаление запрещено!):
- `Тарифы облачного хостинга` (наименование, описание, статус удален/действует, url к изображению `Nullable`, CPU, RAM, SSD, цена)
- `Расчёты стоимости` (только 4 поля `NotNull`: id, статус, дата создания datetime, `клиент`; дата формирования (2 действия `клиента`) datetime, дата завершения (2 действия `администратора`) datetime и `администратор`, итоговая стоимость, длительность)
- `Связь расчёт-тариф` (составной уникальный ключ, дополнительные поля: количество месяцев, основной тариф, комментарий)
- `Пользователи` (для `Django` обязательно использовать системную таблицу, НЕ свою: логин, пароль, признак администратора)

Обязательно наличие 5 или более статусов `расчётов`: черновик, удалён, сформирован, завершён, отклонён. У каждого пользователя не более одного расчёта в статусе `черновик`. Названия таблиц и их полей должны соответствовать предметной области "облачный хостинг". Одно из доп. полей `расчёта` или `связи м-м` рассчитывается при завершении расчёта.

#### Порядок показа
1. Показать формулу для расчета результата (итоговая стоимость облачного хостинга).
2. Показать панель администратора `Django`/`adminer`, в которой добавить новый `тариф облачного хостинга`, посмотреть данные через `select` в БД.
3. Показать 3 страницы приложения: выполнить поиск, удалить расчёт, перейти по `url` удаленного `расчёта`, добавить два тарифа в расчёт (изменение карточки корзины), содержимое расчёта.
4. Показать в БД запросом результаты логического удаления и новый расчёт.
5. В БД изменить поля по теме в `расчёте` и `м-м` и показать их в приложении.
6. В коде показать модели, составной уникальный ключ м-м, 4 контроллера через `ORM`, а удаление расчёта через `SQL UPDATE`.

#### Контрольные вопросы
- Виды БД
- SQL запросы
- Курсоры
- ORM
- Модель и миграции
- Чистая архитектура

#### ER диаграмма
Сделать в StarUML; таблицы, связи, столбцы, типы столбцов и их длина, первичные, внешние ключи.