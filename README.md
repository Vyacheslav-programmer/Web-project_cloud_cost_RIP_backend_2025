# Лабораторная работа 4: Авторизация и сессии

**Тема:** Оценка стоимости облачного хостинга для веб-проекта  
**Студент:** Пронин Вячеслав Константинович, ИУ5Ц-73Б  
**Ветка:** `auth-sessions`

#### Цель работы
Завершение бэкенда для `SPA` системы оценки стоимости облачного хостинга.

#### Задание
Добавление авторизации и `swagger` в веб-сервис, подготовка ТЗ.

Реализовать методы бэкенда для `аутентификации` и `регистрации`. Авторизация через хранение сессий и куки. Автозаполнение пользователя в таблице `расчётов` при создании нового. Добавить описание методов для `swagger`.

Добавить проверку `Permissions` для методов `администратора`. Без авторизации в `Swagger` должно быть доступно только чтение-получение данных через API, с авторизацией - методы `клиента`, а для `администратора` доступны все методы.

Вместе с 4 лабораторной сдается текущий комплект документации, который требуется оформить в виде `.doc`:
- Титульный лист РПЗ
- 3 диаграммы оформить как рисунки в РПЗ
- На 1 листе расчет аппаратных требований (число ядер, ОП, на 1 ядро по 4 ГБ ОП) по количеству пользователей и `rps`, а также требуемый размер жесткого диска с учетом прироста БД за 5 лет. Для расчета `rps` нужно взять количество `расчётов` за день у одного пользователя, определить сколько HTTP `запросов` нужно выполнить для одного расчёта, поделить на рабочее время пользователей. Для прироста БД описать в байтах все поля таблиц `расчёта` и `связи м-м`. Расчет оформить формулами, в них указывать ваши данные, а не общие переменные.
- Приложение 1. ТЗ как приложение к РПЗ
- Приложение 2. Таблица методы веб-сервиса

Состав **ТЗ** на итоговую систему (использовать сплошную нумерацию внутри пунктов):
1. **цель** — разработка системы оценки стоимости облачного хостинга
2. **назначение** — система предназначена для клиентов, выбирающих тарифы облачного хостинга, и администраторов, управляющих тарифами и расчётами
3. **задачи** — 12 задач (8 лабораторных-задач по бекенду/фронтенду, нативное приложение, демо в Pages, документация, репозиторий Git) с указанием ваших технологий по каждой задаче
4. **Функциональные требования** — список HTTP методов, далее список окон и какие действия для каких групп пользователей доступны. Указать, какие методы бэкенда при этом вызываются. Всего 14 подпунктов - HTTP методы, меню и 12 страниц приложения:
   - `гость`: регистрация, аутентификация, главная, список тарифов, один тариф, 403 и 404
   - `клиент`: страница расчёта, список расчётов, личный кабинет
   - `администратор`: список тарифов таблицей, редактирование/создание тарифа
5. **требования к аппаратному** обеспечению для сервера и клиента
6. **требования к программному** обеспечению с версиями для серверных компонентов и для клиента

#### Порядок показа
1. Выполнить метод аутентификации через `swagger` в режиме инкогнито, получить список расчётов в `swagger`.
2. Из браузера использовать содержимое `куки` из вкладки `Application` или `JWT` из ответа аутентификации для заголовков `cookie` или `authorization` соответственно в остальных запросах через `insomnia`/`postman`.
3. Далее в `insomnia`/`postman` выполнить GET списка расчётов: 401/403 для гостя, для клиента только его расчёты.
4. Выполнить PUT завершения расчёта: для клиента 403 статус, для администратора успех и обновление полей.
5. Выполнить GET списка расчётов - для администратора все расчёты.
6. Показать содержимое `Redis` через `cmd`, для сессий показать пользователя.
7. В `StarUML` свойство `signature` у сообщений переиспользовано из диаграммы классов.
8. Сделать скриншоты всех изменений в ТЗ по 2025 году.

#### Контрольные вопросы
- Куки
- Сессия
- Redis
- JWT
- Авторизация и аутентификация
- SSO
- Двухфакторная аутентификация
- RSA

#### Sequence диаграмма
Весь набор `HTTP` запросов по бизнес-процессу без БД и нативного приложения: аутентификация, список тарифов, GET пустой иконки корзины, добавление тарифа в расчёт, GET иконки корзины, просмотр чернового расчёта, редактирование расчёта, формирование расчёта, список расчётов, завершение администратором из второго фронтенда, список расчётов с расчетом. Добавить домены в качестве `Lifeline`, при добавлении сообщений выбирать методы доменов из диаграммы классов, передавать ключевые входные и выходные данные через `arguments` в скобках у `Message`.