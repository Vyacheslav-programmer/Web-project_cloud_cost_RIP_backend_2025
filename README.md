# Лабораторная работа 3: REST API

**Тема:** Оценка стоимости облачного хостинга для веб-проекта  
**Студент:** Пронин Вячеслав Константинович, ИУ5Ц-73Б  
**Ветка:** `rest-api`

#### Цель работы
Создание веб-сервиса в бэкенде нашей системы для использования его в `SPA`.

#### Задание
Создание веб-сервиса со всей итоговой бизнес логикой (кроме авторизации), подключение его к БД и тестирование в `insomnia`/`postman`.

Создание **веб-сервиса** для получения/редактирования данных из вашей БД. Требуется разработать все методы для реализации итоговой бизнес логики вашего приложения. Для изображений `тарифов облачного хостинга` использовать `Minio`.

**Требования к веб-сервису**

Методы и `url` в `API` должны соответствовать `REST`. Для списка `тарифов` (как в 1 лабораторной) и `расчётов` (по статусу и диапазону даты формирования) нужно предусмотреть фильтрацию на бэкенде. Взаимодействие с БД через `ORM`. Не делать `POST` `расчёта`. Записи в статусе `удален` на клиент не передаются.

Статусы нельзя менять с любого на любой: `клиент` удаляет и формирует черновик расчёта, а `администратор` отклоняет и завершает сформированный расчёт. В данной лабораторной пользователь `клиент` зафиксирован во всех методах - укажите его константой через функцию-`singleton`. Системные поля (id, статусы, клиент и администратор, даты создания, формирования и завершения) передавать с клиента для изменения запрещено. Они вычисляются на бэкенде через авторизацию и бизнес-логику. В начале адреса каждого метода добавьте `/api`

**Домен тарифа:**
- GET список с фильтрацией
- GET одна запись 
- POST добавление (без изображения)
- PUT изменение
- DELETE удаление. Удаление изображения встроено в метод удаления тарифа
- POST добавления в расчёт-черновик. `Расчёт` создается пустым, указывается автоматически `клиент`, дата создания и статус, остальные поля указываются через `PUT` или смену статуса
- POST добавление изображения. Добавление изображения по id тарифа, старое изображение заменяется/удаляется. `minio` только в этом методе и удалении! Название изображение генерируется на латинице

**Домен расчёта:**
- GET иконки корзины (без входных параметров, id расчёта вычисляется). Возвращается id расчёта-черновика этого пользователя и количество `тарифов` в этом `расчёте`
- GET список (кроме `удаленных` и `черновика`, поля администратора и клиента через логины) с фильтрацией по диапазону `даты формирования` и статусу. В этом списке выводится `итоговая стоимость` или если результат в м-м, то нужно добавить вычисляемое поле, которое равно количеству записей м-м, в которых рассчитываемое поле результата не пустое (см `лаб. 8`)
- GET одна запись (поля `расчёта` + его `тарифы`). При получении `расчёта` возвращается список его тарифов с картинками
- PUT изменения полей расчёта по теме
- PUT сформировать клиентом (дата формирования). Происходит проверка на обязательные поля
- PUT завершить/отклонить администратором. При завершении/отклонении расчёта проставляется `администратор` и дата завершения. Поле `итоговая стоимость` рассчитывается (реализовать формулу представленную в лаб-2) при завершении расчёта.
- DELETE удаление (дата формирования)

**Домен связи м-м:**
- DELETE удаление из расчёта (без `PK м-м`)
- PUT изменение количества месяцев/основного тарифа/значения в м-м (`без PK м-м`)

**Домен пользователь:**
- POST регистрация
- GET полей пользователя после аутентификации (для личного кабинета)
- PUT пользователя (личный кабинет)
- POST аутентификация
- POST деавторизация

#### Порядок показа
1. Через `insomnia`/`postman` показать коллекцию 21 запросов.
2. Выполнить GET списка `расчётов` (отфильтровать по дате формирования и статусу).
3. GET иконки корзины.
4. Удалить введенный `расчёт` (если есть).
5. Выполнить GET списка `тарифов` (с фильтром).
6. Добавить новый `тариф` и отдельным методом к нему картинку.
7. Добавить `тариф` в `расчёт`.
8. Добавить другой `тариф` в `расчёт`.
9. GET иконки корзины.
10. Посмотреть `расчёт` (из 2 тарифов).
11. Изменить `поле м-м` (количество месяцев).
12. Изменить расчёт.
13. Завершить введенный `расчёт` (показать ошибку).
14. Сформировать `расчёт`.
15. Завершить сформированный расчёт (вычисление итоговой стоимости).
16. Зарегистрировать нового пользователя.
17. Показать измененные данные через select.
18. Объяснить модели, сериализаторы.
19. Показать функцию-`singleton` где пользователь указан константой и использование этой функции в методах.

#### Контрольные вопросы
- Веб-сервис
- REST
- RPC
- Заголовки и методы HTTP
- Версии HTTP
- HTTPS
- OSI ISO

#### Диаграмма классов
С детализацией бэкенда (домены методов по `url` с интерфейсами, перечислить все методы, модели, таблицы БД) + insomnia/postman. Связи у моделей сделать по коду, 3 варианта: методы используют разные модели, модели используют другие модели, модели используют несколько таблиц.